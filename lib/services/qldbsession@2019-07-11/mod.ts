// Autogenerated API client for: Amazon QLDB Session

import type { ServiceClient, ApiFactory, ApiMetadata } from '../../client/common.ts';
interface RequestConfig {
  abortSignal?: AbortSignal;
}

import * as cmnP from "../../encoding/common.ts";
import * as jsonP from "../../encoding/json.ts";

export default class QLDBSession {
  #client: ServiceClient;
  constructor(apiFactory: ApiFactory) {
    this.#client = apiFactory.buildServiceClient(QLDBSession.ApiMetadata);
  }

  static ApiMetadata: ApiMetadata = {
    "apiVersion": "2019-07-11",
    "endpointPrefix": "session.qldb",
    "jsonVersion": "1.0",
    "protocol": "json",
    "serviceAbbreviation": "QLDB Session",
    "serviceFullName": "Amazon QLDB Session",
    "serviceId": "QLDB Session",
    "signatureVersion": "v4",
    "signingName": "qldb",
    "targetPrefix": "QLDBSession",
    "uid": "qldb-session-2019-07-11"
  };

  async sendCommand(
    {abortSignal, ...params}: RequestConfig & SendCommandRequest = {},
  ): Promise<SendCommandResult> {
    const body: jsonP.JSONObject = {
      SessionToken: params["SessionToken"],
      StartSession: fromStartSessionRequest(params["StartSession"]),
      StartTransaction: fromStartTransactionRequest(params["StartTransaction"]),
      EndSession: fromEndSessionRequest(params["EndSession"]),
      CommitTransaction: fromCommitTransactionRequest(params["CommitTransaction"]),
      AbortTransaction: fromAbortTransactionRequest(params["AbortTransaction"]),
      ExecuteStatement: fromExecuteStatementRequest(params["ExecuteStatement"]),
      FetchPage: fromFetchPageRequest(params["FetchPage"]),
    };
    const resp = await this.#client.performRequest({
      abortSignal, body,
      action: "SendCommand",
    });
    return jsonP.readObj({
      required: {},
      optional: {
        "StartSession": toStartSessionResult,
        "StartTransaction": toStartTransactionResult,
        "EndSession": toEndSessionResult,
        "CommitTransaction": toCommitTransactionResult,
        "AbortTransaction": toAbortTransactionResult,
        "ExecuteStatement": toExecuteStatementResult,
        "FetchPage": toFetchPageResult,
      },
    }, await resp.json());
  }

}

// refs: 1 - tags: named, input
export interface SendCommandRequest {
  SessionToken?: string | null;
  StartSession?: StartSessionRequest | null;
  StartTransaction?: StartTransactionRequest | null;
  EndSession?: EndSessionRequest | null;
  CommitTransaction?: CommitTransactionRequest | null;
  AbortTransaction?: AbortTransactionRequest | null;
  ExecuteStatement?: ExecuteStatementRequest | null;
  FetchPage?: FetchPageRequest | null;
}

// refs: 1 - tags: named, output
export interface SendCommandResult {
  StartSession?: StartSessionResult | null;
  StartTransaction?: StartTransactionResult | null;
  EndSession?: EndSessionResult | null;
  CommitTransaction?: CommitTransactionResult | null;
  AbortTransaction?: AbortTransactionResult | null;
  ExecuteStatement?: ExecuteStatementResult | null;
  FetchPage?: FetchPageResult | null;
}

// refs: 1 - tags: input, named, interface
export interface StartSessionRequest {
  LedgerName: string;
}
function fromStartSessionRequest(input?: StartSessionRequest | null): jsonP.JSONValue {
  if (!input) return input;
  return {
    LedgerName: input["LedgerName"],
  }
}

// refs: 1 - tags: input, named, interface
export interface StartTransactionRequest {
}
function fromStartTransactionRequest(input?: StartTransactionRequest | null): jsonP.JSONValue {
  if (!input) return input;
  return {
  }
}

// refs: 1 - tags: input, named, interface
export interface EndSessionRequest {
}
function fromEndSessionRequest(input?: EndSessionRequest | null): jsonP.JSONValue {
  if (!input) return input;
  return {
  }
}

// refs: 1 - tags: input, named, interface
export interface CommitTransactionRequest {
  TransactionId: string;
  CommitDigest: Uint8Array | string;
}
function fromCommitTransactionRequest(input?: CommitTransactionRequest | null): jsonP.JSONValue {
  if (!input) return input;
  return {
    TransactionId: input["TransactionId"],
    CommitDigest: jsonP.serializeBlob(input["CommitDigest"]),
  }
}

// refs: 1 - tags: input, named, interface
export interface AbortTransactionRequest {
}
function fromAbortTransactionRequest(input?: AbortTransactionRequest | null): jsonP.JSONValue {
  if (!input) return input;
  return {
  }
}

// refs: 1 - tags: input, named, interface
export interface ExecuteStatementRequest {
  TransactionId: string;
  Statement: string;
  Parameters?: ValueHolder[] | null;
}
function fromExecuteStatementRequest(input?: ExecuteStatementRequest | null): jsonP.JSONValue {
  if (!input) return input;
  return {
    TransactionId: input["TransactionId"],
    Statement: input["Statement"],
    Parameters: input["Parameters"]?.map(x => fromValueHolder(x)),
  }
}

// refs: 3 - tags: input, named, interface, output
export interface ValueHolder {
  IonBinary?: Uint8Array | string | null;
  IonText?: string | null;
}
function fromValueHolder(input?: ValueHolder | null): jsonP.JSONValue {
  if (!input) return input;
  return {
    IonBinary: jsonP.serializeBlob(input["IonBinary"]),
    IonText: input["IonText"],
  }
}
function toValueHolder(root: jsonP.JSONValue): ValueHolder {
  return jsonP.readObj({
    required: {},
    optional: {
      "IonBinary": "a",
      "IonText": "s",
    },
  }, root);
}

// refs: 1 - tags: input, named, interface
export interface FetchPageRequest {
  TransactionId: string;
  NextPageToken: string;
}
function fromFetchPageRequest(input?: FetchPageRequest | null): jsonP.JSONValue {
  if (!input) return input;
  return {
    TransactionId: input["TransactionId"],
    NextPageToken: input["NextPageToken"],
  }
}

// refs: 1 - tags: output, named, interface
export interface StartSessionResult {
  SessionToken?: string | null;
  TimingInformation?: TimingInformation | null;
}
function toStartSessionResult(root: jsonP.JSONValue): StartSessionResult {
  return jsonP.readObj({
    required: {},
    optional: {
      "SessionToken": "s",
      "TimingInformation": toTimingInformation,
    },
  }, root);
}

// refs: 7 - tags: output, named, interface
export interface TimingInformation {
  ProcessingTimeMilliseconds?: number | null;
}
function toTimingInformation(root: jsonP.JSONValue): TimingInformation {
  return jsonP.readObj({
    required: {},
    optional: {
      "ProcessingTimeMilliseconds": "n",
    },
  }, root);
}

// refs: 1 - tags: output, named, interface
export interface StartTransactionResult {
  TransactionId?: string | null;
  TimingInformation?: TimingInformation | null;
}
function toStartTransactionResult(root: jsonP.JSONValue): StartTransactionResult {
  return jsonP.readObj({
    required: {},
    optional: {
      "TransactionId": "s",
      "TimingInformation": toTimingInformation,
    },
  }, root);
}

// refs: 1 - tags: output, named, interface
export interface EndSessionResult {
  TimingInformation?: TimingInformation | null;
}
function toEndSessionResult(root: jsonP.JSONValue): EndSessionResult {
  return jsonP.readObj({
    required: {},
    optional: {
      "TimingInformation": toTimingInformation,
    },
  }, root);
}

// refs: 1 - tags: output, named, interface
export interface CommitTransactionResult {
  TransactionId?: string | null;
  CommitDigest?: Uint8Array | string | null;
  TimingInformation?: TimingInformation | null;
  ConsumedIOs?: IOUsage | null;
}
function toCommitTransactionResult(root: jsonP.JSONValue): CommitTransactionResult {
  return jsonP.readObj({
    required: {},
    optional: {
      "TransactionId": "s",
      "CommitDigest": "a",
      "TimingInformation": toTimingInformation,
      "ConsumedIOs": toIOUsage,
    },
  }, root);
}

// refs: 3 - tags: output, named, interface
export interface IOUsage {
  ReadIOs?: number | null;
  WriteIOs?: number | null;
}
function toIOUsage(root: jsonP.JSONValue): IOUsage {
  return jsonP.readObj({
    required: {},
    optional: {
      "ReadIOs": "n",
      "WriteIOs": "n",
    },
  }, root);
}

// refs: 1 - tags: output, named, interface
export interface AbortTransactionResult {
  TimingInformation?: TimingInformation | null;
}
function toAbortTransactionResult(root: jsonP.JSONValue): AbortTransactionResult {
  return jsonP.readObj({
    required: {},
    optional: {
      "TimingInformation": toTimingInformation,
    },
  }, root);
}

// refs: 1 - tags: output, named, interface
export interface ExecuteStatementResult {
  FirstPage?: Page | null;
  TimingInformation?: TimingInformation | null;
  ConsumedIOs?: IOUsage | null;
}
function toExecuteStatementResult(root: jsonP.JSONValue): ExecuteStatementResult {
  return jsonP.readObj({
    required: {},
    optional: {
      "FirstPage": toPage,
      "TimingInformation": toTimingInformation,
      "ConsumedIOs": toIOUsage,
    },
  }, root);
}

// refs: 2 - tags: output, named, interface
export interface Page {
  Values?: ValueHolder[] | null;
  NextPageToken?: string | null;
}
function toPage(root: jsonP.JSONValue): Page {
  return jsonP.readObj({
    required: {},
    optional: {
      "Values": [toValueHolder],
      "NextPageToken": "s",
    },
  }, root);
}

// refs: 1 - tags: output, named, interface
export interface FetchPageResult {
  Page?: Page | null;
  TimingInformation?: TimingInformation | null;
  ConsumedIOs?: IOUsage | null;
}
function toFetchPageResult(root: jsonP.JSONValue): FetchPageResult {
  return jsonP.readObj({
    required: {},
    optional: {
      "Page": toPage,
      "TimingInformation": toTimingInformation,
      "ConsumedIOs": toIOUsage,
    },
  }, root);
}
