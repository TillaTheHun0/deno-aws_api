// Autogenerated API client for: Amazon Sagemaker Edge Manager

import type { ServiceClient, ApiFactory, ApiMetadata } from '../../client/common.ts';
interface RequestConfig {
  abortSignal?: AbortSignal;
}

import * as cmnP from "../../encoding/common.ts";
import * as jsonP from "../../encoding/json.ts";

export default class SagemakerEdge {
  #client: ServiceClient;
  constructor(apiFactory: ApiFactory) {
    this.#client = apiFactory.buildServiceClient(SagemakerEdge.ApiMetadata);
  }

  static ApiMetadata: ApiMetadata = {
    "apiVersion": "2020-09-23",
    "endpointPrefix": "edge.sagemaker",
    "jsonVersion": "1.1",
    "protocol": "rest-json",
    "serviceFullName": "Amazon Sagemaker Edge Manager",
    "serviceId": "Sagemaker Edge",
    "signatureVersion": "v4",
    "signingName": "sagemaker",
    "uid": "sagemaker-edge-2020-09-23"
  };

  async getDeviceRegistration(
    {abortSignal, ...params}: RequestConfig & GetDeviceRegistrationRequest,
  ): Promise<GetDeviceRegistrationResult> {
    const body: jsonP.JSONObject = {
      DeviceName: params["DeviceName"],
      DeviceFleetName: params["DeviceFleetName"],
    };
    const resp = await this.#client.performRequest({
      abortSignal, body,
      action: "GetDeviceRegistration",
      requestUri: "/GetDeviceRegistration",
    });
    return jsonP.readObj({
      required: {},
      optional: {
        "DeviceRegistration": "s",
        "CacheTTL": "s",
      },
    }, await resp.json());
  }

  async sendHeartbeat(
    {abortSignal, ...params}: RequestConfig & SendHeartbeatRequest,
  ): Promise<void> {
    const body: jsonP.JSONObject = {
      AgentMetrics: params["AgentMetrics"]?.map(x => fromEdgeMetric(x)),
      Models: params["Models"]?.map(x => fromModel(x)),
      AgentVersion: params["AgentVersion"],
      DeviceName: params["DeviceName"],
      DeviceFleetName: params["DeviceFleetName"],
    };
    const resp = await this.#client.performRequest({
      abortSignal, body,
      action: "SendHeartbeat",
      requestUri: "/SendHeartbeat",
    });
  }

}

// refs: 1 - tags: named, input
export interface GetDeviceRegistrationRequest {
  DeviceName: string;
  DeviceFleetName: string;
}

// refs: 1 - tags: named, input
export interface SendHeartbeatRequest {
  AgentMetrics?: EdgeMetric[] | null;
  Models?: Model[] | null;
  AgentVersion: string;
  DeviceName: string;
  DeviceFleetName: string;
}

// refs: 1 - tags: named, output
export interface GetDeviceRegistrationResult {
  DeviceRegistration?: string | null;
  CacheTTL?: string | null;
}

// refs: 2 - tags: input, named, interface
export interface EdgeMetric {
  Dimension?: string | null;
  MetricName?: string | null;
  Value?: number | null;
  Timestamp?: Date | number | null;
}
function fromEdgeMetric(input?: EdgeMetric | null): jsonP.JSONValue {
  if (!input) return input;
  return {
    Dimension: input["Dimension"],
    MetricName: input["MetricName"],
    Value: input["Value"],
    Timestamp: jsonP.serializeDate_unixTimestamp(input["Timestamp"]),
  }
}

// refs: 1 - tags: input, named, interface
export interface Model {
  ModelName?: string | null;
  ModelVersion?: string | null;
  LatestSampleTime?: Date | number | null;
  LatestInference?: Date | number | null;
  ModelMetrics?: EdgeMetric[] | null;
}
function fromModel(input?: Model | null): jsonP.JSONValue {
  if (!input) return input;
  return {
    ModelName: input["ModelName"],
    ModelVersion: input["ModelVersion"],
    LatestSampleTime: jsonP.serializeDate_unixTimestamp(input["LatestSampleTime"]),
    LatestInference: jsonP.serializeDate_unixTimestamp(input["LatestInference"]),
    ModelMetrics: input["ModelMetrics"]?.map(x => fromEdgeMetric(x)),
  }
}
