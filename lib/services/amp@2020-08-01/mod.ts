// Autogenerated API client for: Amazon Prometheus Service

import type { ServiceClient, ApiFactory, ApiMetadata } from '../../client/common.ts';
interface RequestConfig {
  abortSignal?: AbortSignal;
}

import * as uuidv4 from "https://deno.land/std@0.75.0/uuid/v4.ts";
import * as cmnP from "../../encoding/common.ts";
import * as jsonP from "../../encoding/json.ts";
function generateIdemptToken() {
  return uuidv4.generate();
}

export default class Amp {
  #client: ServiceClient;
  constructor(apiFactory: ApiFactory) {
    this.#client = apiFactory.buildServiceClient(Amp.ApiMetadata);
  }

  static ApiMetadata: ApiMetadata = {
    "apiVersion": "2020-08-01",
    "endpointPrefix": "aps",
    "jsonVersion": "1.1",
    "protocol": "rest-json",
    "serviceFullName": "Amazon Prometheus Service",
    "serviceId": "amp",
    "signatureVersion": "v4",
    "signingName": "aps",
    "uid": "amp-2020-08-01"
  };

  async createWorkspace(
    {abortSignal, ...params}: RequestConfig & CreateWorkspaceRequest = {},
  ): Promise<CreateWorkspaceResponse> {
    const body: jsonP.JSONObject = {
      alias: params["alias"],
      clientToken: params["clientToken"] ?? generateIdemptToken(),
    };
    const resp = await this.#client.performRequest({
      abortSignal, body,
      action: "CreateWorkspace",
      requestUri: "/workspaces",
      responseCode: 202,
    });
    return jsonP.readObj({
      required: {
        "arn": "s",
        "status": toWorkspaceStatus,
        "workspaceId": "s",
      },
      optional: {},
    }, await resp.json());
  }

  async deleteWorkspace(
    {abortSignal, ...params}: RequestConfig & DeleteWorkspaceRequest,
  ): Promise<void> {
    const query = new URLSearchParams;
    if (params["clientToken"] != null) query.set("clientToken", params["clientToken"]?.toString() ?? "");
    const resp = await this.#client.performRequest({
      abortSignal, query,
      action: "DeleteWorkspace",
      method: "DELETE",
      requestUri: cmnP.encodePath`/workspaces/${params["workspaceId"]}`,
      responseCode: 202,
    });
  }

  async describeWorkspace(
    {abortSignal, ...params}: RequestConfig & DescribeWorkspaceRequest,
  ): Promise<DescribeWorkspaceResponse> {

    const resp = await this.#client.performRequest({
      abortSignal,
      action: "DescribeWorkspace",
      method: "GET",
      requestUri: cmnP.encodePath`/workspaces/${params["workspaceId"]}`,
      responseCode: 200,
    });
    return jsonP.readObj({
      required: {
        "workspace": toWorkspaceDescription,
      },
      optional: {},
    }, await resp.json());
  }

  async listWorkspaces(
    {abortSignal, ...params}: RequestConfig & ListWorkspacesRequest = {},
  ): Promise<ListWorkspacesResponse> {
    const query = new URLSearchParams;
    if (params["alias"] != null) query.set("alias", params["alias"]?.toString() ?? "");
    if (params["maxResults"] != null) query.set("maxResults", params["maxResults"]?.toString() ?? "");
    if (params["nextToken"] != null) query.set("nextToken", params["nextToken"]?.toString() ?? "");
    const resp = await this.#client.performRequest({
      abortSignal, query,
      action: "ListWorkspaces",
      method: "GET",
      requestUri: "/workspaces",
      responseCode: 200,
    });
    return jsonP.readObj({
      required: {
        "workspaces": [toWorkspaceSummary],
      },
      optional: {
        "nextToken": "s",
      },
    }, await resp.json());
  }

  async updateWorkspaceAlias(
    {abortSignal, ...params}: RequestConfig & UpdateWorkspaceAliasRequest,
  ): Promise<void> {
    const body: jsonP.JSONObject = {
      alias: params["alias"],
      clientToken: params["clientToken"] ?? generateIdemptToken(),
    };
    const resp = await this.#client.performRequest({
      abortSignal, body,
      action: "UpdateWorkspaceAlias",
      requestUri: cmnP.encodePath`/workspaces/${params["workspaceId"]}/alias`,
      responseCode: 204,
    });
  }

}

// refs: 1 - tags: named, input
export interface CreateWorkspaceRequest {
  alias?: string | null;
  clientToken?: string | null;
}

// refs: 1 - tags: named, input
export interface DeleteWorkspaceRequest {
  clientToken?: string | null;
  workspaceId: string;
}

// refs: 1 - tags: named, input
export interface DescribeWorkspaceRequest {
  workspaceId: string;
}

// refs: 1 - tags: named, input
export interface ListWorkspacesRequest {
  alias?: string | null;
  maxResults?: number | null;
  nextToken?: string | null;
}

// refs: 1 - tags: named, input
export interface UpdateWorkspaceAliasRequest {
  alias?: string | null;
  clientToken?: string | null;
  workspaceId: string;
}

// refs: 1 - tags: named, output
export interface CreateWorkspaceResponse {
  arn: string;
  status: WorkspaceStatus;
  workspaceId: string;
}

// refs: 1 - tags: named, output
export interface DescribeWorkspaceResponse {
  workspace: WorkspaceDescription;
}

// refs: 1 - tags: named, output
export interface ListWorkspacesResponse {
  nextToken?: string | null;
  workspaces: WorkspaceSummary[];
}

// refs: 3 - tags: output, named, interface
export interface WorkspaceStatus {
  statusCode: WorkspaceStatusCode;
}
function toWorkspaceStatus(root: jsonP.JSONValue): WorkspaceStatus {
  return jsonP.readObj({
    required: {
      "statusCode": (x: jsonP.JSONValue) => cmnP.readEnum<WorkspaceStatusCode>(x),
    },
    optional: {},
  }, root);
}

// refs: 3 - tags: output, named, enum
export type WorkspaceStatusCode =
| "CREATING"
| "ACTIVE"
| "UPDATING"
| "DELETING"
| "CREATION_FAILED"
| cmnP.UnexpectedEnumValue;

// refs: 1 - tags: output, named, interface
export interface WorkspaceDescription {
  alias?: string | null;
  arn: string;
  createdAt: Date | number;
  prometheusEndpoint?: string | null;
  status: WorkspaceStatus;
  workspaceId: string;
}
function toWorkspaceDescription(root: jsonP.JSONValue): WorkspaceDescription {
  return jsonP.readObj({
    required: {
      "arn": "s",
      "createdAt": "d",
      "status": toWorkspaceStatus,
      "workspaceId": "s",
    },
    optional: {
      "alias": "s",
      "prometheusEndpoint": "s",
    },
  }, root);
}

// refs: 1 - tags: output, named, interface
export interface WorkspaceSummary {
  alias?: string | null;
  arn: string;
  createdAt: Date | number;
  status: WorkspaceStatus;
  workspaceId: string;
}
function toWorkspaceSummary(root: jsonP.JSONValue): WorkspaceSummary {
  return jsonP.readObj({
    required: {
      "arn": "s",
      "createdAt": "d",
      "status": toWorkspaceStatus,
      "workspaceId": "s",
    },
    optional: {
      "alias": "s",
    },
  }, root);
}
