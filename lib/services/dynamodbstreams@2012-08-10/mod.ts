// Autogenerated API client for: Amazon DynamoDB Streams

import type { ServiceClient, ApiFactory, ApiMetadata } from '../../client/common.ts';
interface RequestConfig {
  abortSignal?: AbortSignal;
}

import * as cmnP from "../../encoding/common.ts";
import * as jsonP from "../../encoding/json.ts";

export default class DynamoDBStreams {
  #client: ServiceClient;
  constructor(apiFactory: ApiFactory) {
    this.#client = apiFactory.buildServiceClient(DynamoDBStreams.ApiMetadata);
  }

  static ApiMetadata: ApiMetadata = {
    "apiVersion": "2012-08-10",
    "endpointPrefix": "streams.dynamodb",
    "jsonVersion": "1.0",
    "protocol": "json",
    "serviceFullName": "Amazon DynamoDB Streams",
    "serviceId": "DynamoDB Streams",
    "signatureVersion": "v4",
    "signingName": "dynamodb",
    "targetPrefix": "DynamoDBStreams_20120810",
    "uid": "streams-dynamodb-2012-08-10"
  };

  async describeStream(
    {abortSignal, ...params}: RequestConfig & DescribeStreamInput,
  ): Promise<DescribeStreamOutput> {
    const body: jsonP.JSONObject = {
      StreamArn: params["StreamArn"],
      Limit: params["Limit"],
      ExclusiveStartShardId: params["ExclusiveStartShardId"],
    };
    const resp = await this.#client.performRequest({
      abortSignal, body,
      action: "DescribeStream",
    });
    return jsonP.readObj({
      required: {},
      optional: {
        "StreamDescription": toStreamDescription,
      },
    }, await resp.json());
  }

  async getRecords(
    {abortSignal, ...params}: RequestConfig & GetRecordsInput,
  ): Promise<GetRecordsOutput> {
    const body: jsonP.JSONObject = {
      ShardIterator: params["ShardIterator"],
      Limit: params["Limit"],
    };
    const resp = await this.#client.performRequest({
      abortSignal, body,
      action: "GetRecords",
    });
    return jsonP.readObj({
      required: {},
      optional: {
        "Records": [toRecord],
        "NextShardIterator": "s",
      },
    }, await resp.json());
  }

  async getShardIterator(
    {abortSignal, ...params}: RequestConfig & GetShardIteratorInput,
  ): Promise<GetShardIteratorOutput> {
    const body: jsonP.JSONObject = {
      StreamArn: params["StreamArn"],
      ShardId: params["ShardId"],
      ShardIteratorType: params["ShardIteratorType"],
      SequenceNumber: params["SequenceNumber"],
    };
    const resp = await this.#client.performRequest({
      abortSignal, body,
      action: "GetShardIterator",
    });
    return jsonP.readObj({
      required: {},
      optional: {
        "ShardIterator": "s",
      },
    }, await resp.json());
  }

  async listStreams(
    {abortSignal, ...params}: RequestConfig & ListStreamsInput = {},
  ): Promise<ListStreamsOutput> {
    const body: jsonP.JSONObject = {
      TableName: params["TableName"],
      Limit: params["Limit"],
      ExclusiveStartStreamArn: params["ExclusiveStartStreamArn"],
    };
    const resp = await this.#client.performRequest({
      abortSignal, body,
      action: "ListStreams",
    });
    return jsonP.readObj({
      required: {},
      optional: {
        "Streams": [toStream],
        "LastEvaluatedStreamArn": "s",
      },
    }, await resp.json());
  }

}

// refs: 1 - tags: named, input
export interface DescribeStreamInput {
  StreamArn: string;
  Limit?: number | null;
  ExclusiveStartShardId?: string | null;
}

// refs: 1 - tags: named, input
export interface GetRecordsInput {
  ShardIterator: string;
  Limit?: number | null;
}

// refs: 1 - tags: named, input
export interface GetShardIteratorInput {
  StreamArn: string;
  ShardId: string;
  ShardIteratorType: ShardIteratorType;
  SequenceNumber?: string | null;
}

// refs: 1 - tags: named, input
export interface ListStreamsInput {
  TableName?: string | null;
  Limit?: number | null;
  ExclusiveStartStreamArn?: string | null;
}

// refs: 1 - tags: named, output
export interface DescribeStreamOutput {
  StreamDescription?: StreamDescription | null;
}

// refs: 1 - tags: named, output
export interface GetRecordsOutput {
  Records?: Record[] | null;
  NextShardIterator?: string | null;
}

// refs: 1 - tags: named, output
export interface GetShardIteratorOutput {
  ShardIterator?: string | null;
}

// refs: 1 - tags: named, output
export interface ListStreamsOutput {
  Streams?: Stream[] | null;
  LastEvaluatedStreamArn?: string | null;
}

// refs: 1 - tags: input, named, enum
export type ShardIteratorType =
| "TRIM_HORIZON"
| "LATEST"
| "AT_SEQUENCE_NUMBER"
| "AFTER_SEQUENCE_NUMBER"
| cmnP.UnexpectedEnumValue;

// refs: 1 - tags: output, named, interface
export interface StreamDescription {
  StreamArn?: string | null;
  StreamLabel?: string | null;
  StreamStatus?: StreamStatus | null;
  StreamViewType?: StreamViewType | null;
  CreationRequestDateTime?: Date | number | null;
  TableName?: string | null;
  KeySchema?: KeySchemaElement[] | null;
  Shards?: Shard[] | null;
  LastEvaluatedShardId?: string | null;
}
function toStreamDescription(root: jsonP.JSONValue): StreamDescription {
  return jsonP.readObj({
    required: {},
    optional: {
      "StreamArn": "s",
      "StreamLabel": "s",
      "StreamStatus": (x: jsonP.JSONValue) => cmnP.readEnum<StreamStatus>(x),
      "StreamViewType": (x: jsonP.JSONValue) => cmnP.readEnum<StreamViewType>(x),
      "CreationRequestDateTime": "d",
      "TableName": "s",
      "KeySchema": [toKeySchemaElement],
      "Shards": [toShard],
      "LastEvaluatedShardId": "s",
    },
  }, root);
}

// refs: 1 - tags: output, named, enum
export type StreamStatus =
| "ENABLING"
| "ENABLED"
| "DISABLING"
| "DISABLED"
| cmnP.UnexpectedEnumValue;

// refs: 2 - tags: output, named, enum
export type StreamViewType =
| "NEW_IMAGE"
| "OLD_IMAGE"
| "NEW_AND_OLD_IMAGES"
| "KEYS_ONLY"
| cmnP.UnexpectedEnumValue;

// refs: 1 - tags: output, named, interface
export interface KeySchemaElement {
  AttributeName: string;
  KeyType: KeyType;
}
function toKeySchemaElement(root: jsonP.JSONValue): KeySchemaElement {
  return jsonP.readObj({
    required: {
      "AttributeName": "s",
      "KeyType": (x: jsonP.JSONValue) => cmnP.readEnum<KeyType>(x),
    },
    optional: {},
  }, root);
}

// refs: 1 - tags: output, named, enum
export type KeyType =
| "HASH"
| "RANGE"
| cmnP.UnexpectedEnumValue;

// refs: 1 - tags: output, named, interface
export interface Shard {
  ShardId?: string | null;
  SequenceNumberRange?: SequenceNumberRange | null;
  ParentShardId?: string | null;
}
function toShard(root: jsonP.JSONValue): Shard {
  return jsonP.readObj({
    required: {},
    optional: {
      "ShardId": "s",
      "SequenceNumberRange": toSequenceNumberRange,
      "ParentShardId": "s",
    },
  }, root);
}

// refs: 1 - tags: output, named, interface
export interface SequenceNumberRange {
  StartingSequenceNumber?: string | null;
  EndingSequenceNumber?: string | null;
}
function toSequenceNumberRange(root: jsonP.JSONValue): SequenceNumberRange {
  return jsonP.readObj({
    required: {},
    optional: {
      "StartingSequenceNumber": "s",
      "EndingSequenceNumber": "s",
    },
  }, root);
}

// refs: 1 - tags: output, named, interface
export interface Record {
  eventID?: string | null;
  eventName?: OperationType | null;
  eventVersion?: string | null;
  eventSource?: string | null;
  awsRegion?: string | null;
  dynamodb?: StreamRecord | null;
  userIdentity?: Identity | null;
}
function toRecord(root: jsonP.JSONValue): Record {
  return jsonP.readObj({
    required: {},
    optional: {
      "eventID": "s",
      "eventName": (x: jsonP.JSONValue) => cmnP.readEnum<OperationType>(x),
      "eventVersion": "s",
      "eventSource": "s",
      "awsRegion": "s",
      "dynamodb": toStreamRecord,
      "userIdentity": toIdentity,
    },
  }, root);
}

// refs: 1 - tags: output, named, enum
export type OperationType =
| "INSERT"
| "MODIFY"
| "REMOVE"
| cmnP.UnexpectedEnumValue;

// refs: 1 - tags: output, named, interface
export interface StreamRecord {
  ApproximateCreationDateTime?: Date | number | null;
  Keys?: { [key: string]: AttributeValue | null | undefined } | null;
  NewImage?: { [key: string]: AttributeValue | null | undefined } | null;
  OldImage?: { [key: string]: AttributeValue | null | undefined } | null;
  SequenceNumber?: string | null;
  SizeBytes?: number | null;
  StreamViewType?: StreamViewType | null;
}
function toStreamRecord(root: jsonP.JSONValue): StreamRecord {
  return jsonP.readObj({
    required: {},
    optional: {
      "ApproximateCreationDateTime": "d",
      "Keys": x => jsonP.readMap(String, toAttributeValue, x),
      "NewImage": x => jsonP.readMap(String, toAttributeValue, x),
      "OldImage": x => jsonP.readMap(String, toAttributeValue, x),
      "SequenceNumber": "s",
      "SizeBytes": "n",
      "StreamViewType": (x: jsonP.JSONValue) => cmnP.readEnum<StreamViewType>(x),
    },
  }, root);
}

// refs: 9 - tags: output, named, interface, recursed
export interface AttributeValue {
  S?: string | null;
  N?: string | null;
  B?: Uint8Array | string | null;
  SS?: string[] | null;
  NS?: string[] | null;
  BS?: (Uint8Array | string)[] | null;
  M?: { [key: string]: AttributeValue | null | undefined } | null;
  L?: AttributeValue[] | null;
  NULL?: boolean | null;
  BOOL?: boolean | null;
}
function toAttributeValue(root: jsonP.JSONValue): AttributeValue {
  return jsonP.readObj({
    required: {},
    optional: {
      "S": "s",
      "N": "s",
      "B": "a",
      "SS": ["s"],
      "NS": ["s"],
      "BS": ["a"],
      "M": x => jsonP.readMap(String, toAttributeValue, x),
      "L": [toAttributeValue],
      "NULL": "b",
      "BOOL": "b",
    },
  }, root);
}

// refs: 1 - tags: output, named, interface
export interface Identity {
  PrincipalId?: string | null;
  Type?: string | null;
}
function toIdentity(root: jsonP.JSONValue): Identity {
  return jsonP.readObj({
    required: {},
    optional: {
      "PrincipalId": "s",
      "Type": "s",
    },
  }, root);
}

// refs: 1 - tags: output, named, interface
export interface Stream {
  StreamArn?: string | null;
  TableName?: string | null;
  StreamLabel?: string | null;
}
function toStream(root: jsonP.JSONValue): Stream {
  return jsonP.readObj({
    required: {},
    optional: {
      "StreamArn": "s",
      "TableName": "s",
      "StreamLabel": "s",
    },
  }, root);
}
