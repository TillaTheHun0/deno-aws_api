// Autogenerated API client for: AWS Single Sign-On

interface RequestConfig {
  abortSignal?: AbortSignal;
}

import * as cmnP from "../../encoding/common.ts";
import * as client from "../../client/common.ts";
import type * as s from "./structs.ts";
import * as jsonP from "../../encoding/json.ts";

export default class SSO {
  #client: client.ServiceClient;
  constructor(apiFactory: client.ApiFactory) {
    this.#client = apiFactory.buildServiceClient(SSO.ApiMetadata);
  }

  static ApiMetadata: client.ApiMetadata = {
    "apiVersion": "2019-06-10",
    "endpointPrefix": "portal.sso",
    "jsonVersion": "1.1",
    "protocol": "rest-json",
    "serviceAbbreviation": "SSO",
    "serviceFullName": "AWS Single Sign-On",
    "serviceId": "SSO",
    "signatureVersion": "v4",
    "signingName": "awsssoportal",
    "uid": "sso-2019-06-10"
  };

  async getRoleCredentials(
    {abortSignal, ...params}: RequestConfig & s.GetRoleCredentialsRequest,
  ): Promise<s.GetRoleCredentialsResponse> {
    const headers = new Headers;
    const query = new URLSearchParams;
    query.set("role_name", params["roleName"]?.toString() ?? "");
    query.set("account_id", params["accountId"]?.toString() ?? "");
    headers.append("x-amz-sso_bearer_token", params["accessToken"]);
    const resp = await this.#client.performRequest({
      abortSignal, headers, query,
      action: "GetRoleCredentials",
      method: "GET",
      requestUri: "/federation/credentials",
    });
    return jsonP.readObj({
      required: {},
      optional: {
        "roleCredentials": toRoleCredentials,
      },
    }, await resp.json());
  }

  async listAccountRoles(
    {abortSignal, ...params}: RequestConfig & s.ListAccountRolesRequest,
  ): Promise<s.ListAccountRolesResponse> {
    const headers = new Headers;
    const query = new URLSearchParams;
    if (params["nextToken"] != null) query.set("next_token", params["nextToken"]?.toString() ?? "");
    if (params["maxResults"] != null) query.set("max_result", params["maxResults"]?.toString() ?? "");
    headers.append("x-amz-sso_bearer_token", params["accessToken"]);
    query.set("account_id", params["accountId"]?.toString() ?? "");
    const resp = await this.#client.performRequest({
      abortSignal, headers, query,
      action: "ListAccountRoles",
      method: "GET",
      requestUri: "/assignment/roles",
    });
    return jsonP.readObj({
      required: {},
      optional: {
        "nextToken": "s",
        "roleList": [toRoleInfo],
      },
    }, await resp.json());
  }

  async listAccounts(
    {abortSignal, ...params}: RequestConfig & s.ListAccountsRequest,
  ): Promise<s.ListAccountsResponse> {
    const headers = new Headers;
    const query = new URLSearchParams;
    if (params["nextToken"] != null) query.set("next_token", params["nextToken"]?.toString() ?? "");
    if (params["maxResults"] != null) query.set("max_result", params["maxResults"]?.toString() ?? "");
    headers.append("x-amz-sso_bearer_token", params["accessToken"]);
    const resp = await this.#client.performRequest({
      abortSignal, headers, query,
      action: "ListAccounts",
      method: "GET",
      requestUri: "/assignment/accounts",
    });
    return jsonP.readObj({
      required: {},
      optional: {
        "nextToken": "s",
        "accountList": [toAccountInfo],
      },
    }, await resp.json());
  }

  async logout(
    {abortSignal, ...params}: RequestConfig & s.LogoutRequest,
  ): Promise<void> {
    const headers = new Headers;
    headers.append("x-amz-sso_bearer_token", params["accessToken"]);
    const resp = await this.#client.performRequest({
      abortSignal, headers,
      action: "Logout",
      requestUri: "/logout",
    });
  }

}

function toRoleCredentials(root: jsonP.JSONValue): s.RoleCredentials {
  return jsonP.readObj({
    required: {},
    optional: {
      "accessKeyId": "s",
      "secretAccessKey": "s",
      "sessionToken": "s",
      "expiration": "n",
    },
  }, root);
}

function toRoleInfo(root: jsonP.JSONValue): s.RoleInfo {
  return jsonP.readObj({
    required: {},
    optional: {
      "roleName": "s",
      "accountId": "s",
    },
  }, root);
}

function toAccountInfo(root: jsonP.JSONValue): s.AccountInfo {
  return jsonP.readObj({
    required: {},
    optional: {
      "accountId": "s",
      "accountName": "s",
      "emailAddress": "s",
    },
  }, root);
}
