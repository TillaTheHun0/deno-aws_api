// Autogenerated API client for: AWS IoT Fleet Hub

import type { ServiceClient, ApiFactory, ApiMetadata } from '../../client/common.ts';
interface RequestConfig {
  abortSignal?: AbortSignal;
}

import * as uuidv4 from "https://deno.land/std@0.86.0/uuid/v4.ts";
import * as cmnP from "../../encoding/common.ts";
import * as jsonP from "../../encoding/json.ts";
function generateIdemptToken() {
  return uuidv4.generate();
}

export default class IoTFleetHub {
  #client: ServiceClient;
  constructor(apiFactory: ApiFactory) {
    this.#client = apiFactory.buildServiceClient(IoTFleetHub.ApiMetadata);
  }

  static ApiMetadata: ApiMetadata = {
    "apiVersion": "2020-11-03",
    "endpointPrefix": "api.fleethub.iot",
    "jsonVersion": "1.1",
    "protocol": "rest-json",
    "serviceFullName": "AWS IoT Fleet Hub",
    "serviceId": "IoTFleetHub",
    "signatureVersion": "v4",
    "signingName": "iotfleethub",
    "uid": "iotfleethub-2020-11-03"
  };

  async createApplication(
    {abortSignal, ...params}: RequestConfig & CreateApplicationRequest,
  ): Promise<CreateApplicationResponse> {
    const body: jsonP.JSONObject = {
      applicationName: params["applicationName"],
      applicationDescription: params["applicationDescription"],
      clientToken: params["clientToken"] ?? generateIdemptToken(),
      roleArn: params["roleArn"],
      tags: params["tags"],
    };
    const resp = await this.#client.performRequest({
      abortSignal, body,
      action: "CreateApplication",
      requestUri: "/applications",
      responseCode: 201,
    });
    return jsonP.readObj({
      required: {
        "applicationId": "s",
        "applicationArn": "s",
      },
      optional: {},
    }, await resp.json());
  }

  async deleteApplication(
    {abortSignal, ...params}: RequestConfig & DeleteApplicationRequest,
  ): Promise<DeleteApplicationResponse> {
    const query = new URLSearchParams;
    if (params["clientToken"] != null) query.set("clientToken", params["clientToken"]?.toString() ?? "");
    const resp = await this.#client.performRequest({
      abortSignal, query,
      action: "DeleteApplication",
      method: "DELETE",
      requestUri: cmnP.encodePath`/applications/${params["applicationId"]}`,
      responseCode: 204,
    });
    return jsonP.readObj({
      required: {},
      optional: {},
    }, await resp.json());
  }

  async describeApplication(
    {abortSignal, ...params}: RequestConfig & DescribeApplicationRequest,
  ): Promise<DescribeApplicationResponse> {

    const resp = await this.#client.performRequest({
      abortSignal,
      action: "DescribeApplication",
      method: "GET",
      requestUri: cmnP.encodePath`/applications/${params["applicationId"]}`,
      responseCode: 200,
    });
    return jsonP.readObj({
      required: {
        "applicationId": "s",
        "applicationArn": "s",
        "applicationName": "s",
        "applicationUrl": "s",
        "applicationState": (x: jsonP.JSONValue) => cmnP.readEnum<ApplicationState>(x),
        "applicationCreationDate": "n",
        "applicationLastUpdateDate": "n",
        "roleArn": "s",
      },
      optional: {
        "applicationDescription": "s",
        "ssoClientId": "s",
        "errorMessage": "s",
        "tags": x => jsonP.readMap(String, String, x),
      },
    }, await resp.json());
  }

  async listApplications(
    {abortSignal, ...params}: RequestConfig & ListApplicationsRequest = {},
  ): Promise<ListApplicationsResponse> {
    const query = new URLSearchParams;
    if (params["nextToken"] != null) query.set("nextToken", params["nextToken"]?.toString() ?? "");
    const resp = await this.#client.performRequest({
      abortSignal, query,
      action: "ListApplications",
      method: "GET",
      requestUri: "/applications",
      responseCode: 200,
    });
    return jsonP.readObj({
      required: {},
      optional: {
        "applicationSummaries": [toApplicationSummary],
        "nextToken": "s",
      },
    }, await resp.json());
  }

  async listTagsForResource(
    {abortSignal, ...params}: RequestConfig & ListTagsForResourceRequest,
  ): Promise<ListTagsForResourceResponse> {

    const resp = await this.#client.performRequest({
      abortSignal,
      action: "ListTagsForResource",
      method: "GET",
      requestUri: cmnP.encodePath`/tags/${params["resourceArn"]}`,
    });
    return jsonP.readObj({
      required: {},
      optional: {
        "tags": x => jsonP.readMap(String, String, x),
      },
    }, await resp.json());
  }

  async tagResource(
    {abortSignal, ...params}: RequestConfig & TagResourceRequest,
  ): Promise<TagResourceResponse> {
    const body: jsonP.JSONObject = {
      tags: params["tags"],
    };
    const resp = await this.#client.performRequest({
      abortSignal, body,
      action: "TagResource",
      requestUri: cmnP.encodePath`/tags/${params["resourceArn"]}`,
    });
    return jsonP.readObj({
      required: {},
      optional: {},
    }, await resp.json());
  }

  async untagResource(
    {abortSignal, ...params}: RequestConfig & UntagResourceRequest,
  ): Promise<UntagResourceResponse> {
    const query = new URLSearchParams;
    for (const item of params["tagKeys"]) {
      query.append("tagKeys", item?.toString() ?? "");
    }
    const resp = await this.#client.performRequest({
      abortSignal, query,
      action: "UntagResource",
      method: "DELETE",
      requestUri: cmnP.encodePath`/tags/${params["resourceArn"]}`,
    });
    return jsonP.readObj({
      required: {},
      optional: {},
    }, await resp.json());
  }

  async updateApplication(
    {abortSignal, ...params}: RequestConfig & UpdateApplicationRequest,
  ): Promise<UpdateApplicationResponse> {
    const body: jsonP.JSONObject = {
      applicationName: params["applicationName"],
      applicationDescription: params["applicationDescription"],
      clientToken: params["clientToken"] ?? generateIdemptToken(),
    };
    const resp = await this.#client.performRequest({
      abortSignal, body,
      action: "UpdateApplication",
      method: "PATCH",
      requestUri: cmnP.encodePath`/applications/${params["applicationId"]}`,
      responseCode: 202,
    });
    return jsonP.readObj({
      required: {},
      optional: {},
    }, await resp.json());
  }

}

// refs: 1 - tags: named, input
export interface CreateApplicationRequest {
  applicationName: string;
  applicationDescription?: string | null;
  clientToken?: string | null;
  roleArn: string;
  tags?: { [key: string]: string | null | undefined } | null;
}

// refs: 1 - tags: named, input
export interface DeleteApplicationRequest {
  applicationId: string;
  clientToken?: string | null;
}

// refs: 1 - tags: named, input
export interface DescribeApplicationRequest {
  applicationId: string;
}

// refs: 1 - tags: named, input
export interface ListApplicationsRequest {
  nextToken?: string | null;
}

// refs: 1 - tags: named, input
export interface ListTagsForResourceRequest {
  resourceArn: string;
}

// refs: 1 - tags: named, input
export interface TagResourceRequest {
  resourceArn: string;
  tags: { [key: string]: string | null | undefined };
}

// refs: 1 - tags: named, input
export interface UntagResourceRequest {
  resourceArn: string;
  tagKeys: string[];
}

// refs: 1 - tags: named, input
export interface UpdateApplicationRequest {
  applicationId: string;
  applicationName?: string | null;
  applicationDescription?: string | null;
  clientToken?: string | null;
}

// refs: 1 - tags: named, output
export interface CreateApplicationResponse {
  applicationId: string;
  applicationArn: string;
}

// refs: 1 - tags: named, output
export interface DeleteApplicationResponse {
}

// refs: 1 - tags: named, output
export interface DescribeApplicationResponse {
  applicationId: string;
  applicationArn: string;
  applicationName: string;
  applicationDescription?: string | null;
  applicationUrl: string;
  applicationState: ApplicationState;
  applicationCreationDate: number;
  applicationLastUpdateDate: number;
  roleArn: string;
  ssoClientId?: string | null;
  errorMessage?: string | null;
  tags?: { [key: string]: string | null | undefined } | null;
}

// refs: 1 - tags: named, output
export interface ListApplicationsResponse {
  applicationSummaries?: ApplicationSummary[] | null;
  nextToken?: string | null;
}

// refs: 1 - tags: named, output
export interface ListTagsForResourceResponse {
  tags?: { [key: string]: string | null | undefined } | null;
}

// refs: 1 - tags: named, output
export interface TagResourceResponse {
}

// refs: 1 - tags: named, output
export interface UntagResourceResponse {
}

// refs: 1 - tags: named, output
export interface UpdateApplicationResponse {
}

// refs: 2 - tags: output, named, enum
export type ApplicationState =
| "CREATING"
| "DELETING"
| "ACTIVE"
| "CREATE_FAILED"
| "DELETE_FAILED"
| cmnP.UnexpectedEnumValue;

// refs: 1 - tags: output, named, interface
export interface ApplicationSummary {
  applicationId: string;
  applicationName: string;
  applicationDescription?: string | null;
  applicationUrl: string;
  applicationCreationDate?: number | null;
  applicationLastUpdateDate?: number | null;
  applicationState?: ApplicationState | null;
}
function toApplicationSummary(root: jsonP.JSONValue): ApplicationSummary {
  return jsonP.readObj({
    required: {
      "applicationId": "s",
      "applicationName": "s",
      "applicationUrl": "s",
    },
    optional: {
      "applicationDescription": "s",
      "applicationCreationDate": "n",
      "applicationLastUpdateDate": "n",
      "applicationState": (x: jsonP.JSONValue) => cmnP.readEnum<ApplicationState>(x),
    },
  }, root);
}
